<html
    xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
    xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
    xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
    xmlns:easyconf="http://typo3.org/ns/Buepro/Easyconf/ViewHelpers"
    data-namespace-typo3-fluid="true">

<f:layout name="Module" />

<f:section name="Content">
    <h1>{f:translate(key: 'index.title')}</h1>
    <div class="col-md-8 col-lg-7 col-xl-6">
        <f:if condition="{templateUid} == 0 || {multipleTypes} >= 2">
            <f:if condition="{hidePageNavigation}">
                <f:then>
                    <f:render section="options" arguments="{_all}" />
                </f:then>
                <f:else>
                    <f:be.infobox state="-2" title="{f:translate(key: 'noTemplate.title')}">
                        <f:render section="options" arguments="{_all}" />
                    </f:be.infobox>
                </f:else>
            </f:if>
        </f:if>
        <f:if condition="{agency.url} || {agency.email} || {agency.phone}">
            <f:render section="Support" arguments="{_all}" />
        </f:if>
        <f:be.infobox state="-1" title="{f:translate(key: 'info.restoreFieldValue.title')}">
            <p>{f:translate(key: 'noTemplate.description')}</p>
            {f:translate(key: 'info.restoreFieldValue.description')}
        </f:be.infobox>
    </div>
</f:section>

<f:section name="options">
    <f:for each="{sites}" as="site">
        <f:if condition="{types -> f:count()} > 1">
            <f:then>
                <h2>{site.rootPageTitle}</h2>
                <div class="card-container">
                    <f:for each="{types}" as="typeData" key="typeKey">
                        <div class="card card-size-fixed-small">
                            <div class="card-header">
                                <div class="card-icon">
                                    <f:render section="groupIcon" arguments="{_all}" />
                                </div>
                                <div class="card-header-body">
                                    <h2 class="card-title">{f:translate(key: '{typeData.title}')}</h2>
                                    <span class="card-subtitle">{f:translate(key: '{typeData.subtitle}')}</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <p class="card-text">{f:translate(key: '{typeData.description}')}</p>
                            </div>
                            <div class="card-footer">
                                <easyconf:link.editRecord
                                    class="btn btn-primary"
                                    data="{inline:1}"
                                    returnUrl="{f:be.uri(route: 'web_Easyconf')}"
                                    table="tx_easyconf_configuration"
                                    uid="{site.configurationUid}"
                                    group="{typeKey}"
                                >
                                 <f:variable name="groupTitle"><f:translate key="{typeData.title}" /></f:variable>
                                    <f:format.printf arguments="{groupTitle: groupTitle}">{f:translate(key: 'editGroup')}</f:format.printf>
                                </easyconf:link.editRecord>
                            </div>
                        </div>
                    </f:for>
                </div>
            </f:then>
            <f:else>
                <be:link.editRecord
                    class="btn btn-success me-2 mb-2"
                    returnUrl="{f:be.uri(route: 'web_Easyconf')}"
                    table="tx_easyconf_configuration"
                    uid="{site.configurationUid}"
                >
                    <f:format.printf arguments="{pageTitle: site.rootPageTitle}">{f:translate(key: 'selectPage')}</f:format.printf>
                </be:link.editRecord>
            </f:else>
        </f:if>

    </f:for>
    <f:if condition="{isAdmin}">
        <a class="btn btn-primary mb-2" href="{be:moduleLink(route: 'web_ts', arguments: '{id: pageUid}')}">{f:translate(key: 'switchTemplateModule')}</a>
    </f:if>
</f:section>

<f:section name="groupIcon">
    <f:variable name="defaultIcon">EXT:easyconf/Resources/Public/Icons/Extension.svg</f:variable>
    <f:variable name="icon"><f:split separator=":" value="{typeData.cardIcon ? typeData.cardIcon : defaultIcon}" limit="2"/></f:variable>
    <f:if condition="{icon.0} == 'icon'">
        <f:then>
            <core:icon identifier="{icon.1}" size="mega"></core:icon>
        </f:then>
        <f:else>
            <f:image src="{icon.0}:{icon.1}" width="64" height="64" />
        </f:else>
    </f:if>
</f:section>

<f:section name="Support">
    <f:be.infobox state="0" title="{f:translate(key: 'support.title')}">
        <p>{f:translate(key: 'support.description')}</p>
        <f:if condition="{agency.url}">
            <a class="btn btn-default" href="{agency.url}" target="_blank" title="{f:translate(key: 'support.action.info')}" role="button">
                <span class="icon icon-size-small icon-state-default">
                    <span class="icon-markup">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g class="icon-color"><path d="M8 2c3.3 0 6 2.7 6 6s-2.7 6-6 6-6-2.7-6-6 2.7-6 6-6m0-1C4.1 1 1 4.1 1 8s3.1 7 7 7 7-3.1 7-7-3.1-7-7-7z"/><path d="M7 5a1 1 0 1 1 2 0 1 1 0 1 1-2 0zM7 8a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0V8z"/></g></svg>
                    </span>
                </span>
            </a>
        </f:if>
        <f:if condition="{agency.email}">
            <a class="btn btn-default" href="mailto:{agency.email}" target="_blank" title="{f:translate(key: 'support.action.email')}" role="button">
                <span class="icon icon-size-small icon-state-default">
                    <span class="icon-markup">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g class="icon-color"><path d="M14 3v8H8.7l-.2.1L5 13.2V11H2V3h12M1.6 2c-.3 0-.6.3-.6.6v8.9c0 .3.2.5.5.5H4v3l5-3h5.5c.3 0 .5-.2.5-.5v-9c0-.3-.2-.5-.5-.5H1.6z"/><path d="M3 6h8v1H3zM3 8h6v1H3zM3 4h10v1H3z"/></g></svg>
                    </span>
                </span>
            </a>
        </f:if>
        <f:if condition="{agency.phone}">
            <a class="btn btn-default" href="tel:{agency.phone}" title="{f:translate(key: 'support.action.phone')}" role="button">
                <span class="icon icon-size-small icon-state-default">
                    <span class="icon-markup">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g class="icon-color"><path d="M10.486 2h3.492c-.166 3.723-1.278 6.635-3.31 8.668C8.635 12.7 5.723 13.812 2 13.978v-3.492c.995-.033 1.885-.126 2.721-.35l1.072 1.071.51.51.646-.324c2.018-1.014 3.43-2.426 4.444-4.444l.325-.645-.51-.511-1.073-1.072c.225-.836.318-1.726.35-2.721m-.126-1H9.5c0 1.535-.074 2.827-.5 4l1.5 1.5c-.92 1.83-2.17 3.08-4 4L5 9c-1.173.426-2.465.5-4 .5V15c9 0 14-5 14-14h-4.64z"/></g></svg>
                    </span>
                </span>
            </a>
        </f:if>
    </f:be.infobox>
</f:section>

</html>
